<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Workflow Run Deleter</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-dark: rgba(10, 7, 15, 1);
            --card-bg: #000;
            --primary: #bb86fc;
            --primary-dark: #9a67cf;
            --primary-darker: rgba(29, 18, 44, 1);
            --text: #e0e0e0;
            --text-secondary: #a0a0a0;
            --danger: #cf6679;
            --success: #03dac6;
            --border: #111;
            --warning: #ffb74d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
            width: 100%;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--primary-dark);
        }
        
        .card-title {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .card-title i {
            margin-right: 10px;
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        input,
        select {
            width: 100%;
            padding: 14px;
            background-color: #2d2d2d;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: #121212;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            opacity: 0.9;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .flex-row {
            display: flex;
            gap: 15px;
        }
        
        .flex-row .form-group {
            flex: 1;
        }
        
        .workflow-run {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .workflow-run:last-child {
            border-bottom: none;
        }
        
        .run-info {
            flex: 1;
        }
        
        .run-id {
            font-weight: 600;
            color: var(--primary);
        }
        
        .run-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        .status-success {
            background-color: rgba(3, 218, 198, 0.15);
            color: var(--success);
        }
        
        .status-failure {
            background-color: rgba(207, 102, 121, 0.15);
            color: var(--danger);
        }
        
        .status-pending {
            background-color: rgba(255, 193, 7, 0.15);
            color: #ffc107;
        }
        
        .status-cancelled {
            background-color: rgba(100, 100, 100, 0.15);
            color: #a0a0a0;
        }
        
        .run-actions {
            margin-left: 15px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 0;
            color: var(--text-secondary);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 20px;
            color: var(--primary-dark);
        }
        
        .loading {
            display: flex;
            justify-content: center;
            padding: 30px;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .spinner {
            flex-direction: column;
            text-align: center;
        }
        
        .mona {
            width: 80px;
            height: 80px;
            margin-right: 15px;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            
            100% {
                transform: rotate(360deg);
            }
        }
        
        .result-count {
            margin: 15px 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .delete-all {
            display: flex;
            justify-content: flex-start;
            margin-bottom: 20px;
        }
        
        .footer {
            font-family: monospace;
            text-align: center;
            width: 100%;
            padding: 20px;
            margin-top: 30px;
            background: var(--bg-dark);
            border-top: 1px solid var(--primary-dark);
            font-size: 0.9rem;
            font-size: calc(0.8rem / 1.618);
        }
        
        .footer .onep {
            font-size: 0.8rem;
        }
        
        .footer .contact {
            font-size: 0.8rem;
            margin-bottom: 5px;
            margin-top: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5A65D9;
        }
        
        .footer .contact span {
            margin-left: 5px;
            margin-right: 5px;
            color: #fff;
        }
        
        .version {
            color: #5A65D9;
            font-weight: 400;
        }
        
        a {
            color: #5A65D9;
            font-weight: 600;
        }
        
        a:hover {
            color: #3e44b8;
        }
        
        .progress-container {
            width: 100%;
            background-color: #2d2d2d;
            border-radius: 8px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 8px;
            background-color: var(--primary);
            border-radius: 8px;
            transition: width 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .flex-row {
                flex-direction: column;
                gap: 0;
            }
            
            .workflow-run {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .run-actions {
                margin-left: 0;
                margin-top: 15px;
                width: 100%;
            }
            
            .run-actions .btn {
                width: 100%;
            }
        }
        
        /* Toast notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }
        
        .toast {
            padding: 12px 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            backdrop-filter: blur(15px);
            animation: fadeIn 0.3s ease;
            transform: translateX(0);
            transition: transform 0.3s ease, opacity 0.3s ease;
            font-size: 13px;
        }
        
        .toast.hide {
            transform: translateX(100%);
            opacity: 0;
        }
        
        .toast i {
            margin-right: 12px;
        }
        
        .toast-success {
            background-color: rgba(3, 218, 198, 0.15);
            border: 1px solid rgba(3, 218, 198, 0.3);
            color: var(--success);
        }
        
        .toast-error {
            background-color: rgba(207, 102, 121, 0.15);
            border: 1px solid rgba(207, 102, 121, 0.3);
            color: var(--danger);
        }
        
        .toast-info {
            background-color: rgba(187, 134, 252, 0.15);
            border: 1px solid rgba(187, 134, 252, 0.3);
            color: var(--primary);
        }
        
        .toast-warning {
            background-color: rgba(255, 183, 77, 0.15);
            border: 1px solid rgba(255, 183, 77, 0.3);
            color: var(--warning);
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* Custom confirm dialog */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-dialog {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.show .modal-dialog {
            transform: translateY(0);
        }
        
        .modal-header {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .modal-header i {
            font-size: 1.8rem;
            margin-right: 15px;
            color: var(--danger);
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: var(--text);
        }
        
        .modal-body {
            margin-bottom: 25px;
            color: var(--text-secondary);
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        .btn-secondary {
            background-color: #444;
            color: var(--text);
        }
        
        .btn-secondary:hover {
            background-color: #555;
        }
        
        .satirical-message {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            background-color: rgba(255, 183, 77, 0.1);
            border: 1px solid rgba(255, 183, 77, 0.2);
            color: var(--warning);
            font-style: italic;
            display: none;
        }
        
        #successContainer {}
        
        #successContainer .fas {
            color: var(--success);
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>
    <!-- Toast notifications container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- Modal overlay for confirm dialogs -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal-dialog">
            <div class="modal-header">
                <i class="fas fa-exclamation-triangle"></i>
                <h3 class="modal-title" id="modalTitle">Confirm Action</h3>
            </div>
            <div class="modal-body" id="modalBody">
                Are you sure you want to perform this action?
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelBtn">Cancel</button>
                <button class="btn btn-danger" id="confirmBtn">Confirm</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <header>
            <h1><i class="fab fa-github"></i> GitHub Workflow Run Deleter</h1>
            <p class="subtitle">Securely delete workflow run history from your GitHub repositories</p>
            
            
        </header>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-key"></i> Repository & Access</h2>
            
            <div class="flex-row">
                <div class="form-group">
                    <label for="owner">Repository Owner</label>
                    <input type="text" id="owner" placeholder="your-username" value="octocat">
                </div>
                
                <div class="form-group">
                    <label for="repo">Repository Name</label>
                    <input type="text" id="repo" placeholder="your-repo-name" value="Hello-World">
                </div>
            </div>
            
            <div class="form-group">
                <label for="token">GitHub Personal Access Token</label>
                <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" value="ghp_xxxxxxxxxxxxxxxxxxxx">
                <small style="color: var(--text-secondary); display: block; margin-top: 8px;">
                    Requires <code>repo</code> scope. Create one in GitHub Settings > Developer Settings
                </small>
            </div>
            
            <div class="form-group">
                <label for="status">Filter by Status</label>
                <select id="status">
                    <option value="all">All Statuses</option>
                    <option value="success">Success</option>
                    <option value="failure">Failure</option>
                    <option value="cancelled">Cancelled</option>
                </select>
            </div>
            
            <button id="fetchBtn" class="btn btn-primary">
                <i class="fas fa-cloud-download-alt"></i> Fetch Workflow Runs
            </button>
        </div>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-list"></i> Workflow Runs</h2>
            
            <!-- Initial empty state -->
            <div id="resultsContainer">
                <div class="empty-state">
                    <i class="fas fa-cloud"></i>
                    <h3>No workflow runs found</h3>
                    <p>Enter your repository details and fetch workflow runs to get started</p>
                </div>
            </div>
            
            <!-- Success state -->
            <div id="successContainer" class="hidden">
                <div class="empty-state">
                    <i class="fas fa-check-circle"></i>
                    <h3>Successfully deleted!</h3>
                    <p>All workflows deleted successfully.</p>
                    <button class="btn btn-primary" id="backToSearchBtn" style="margin-top: 20px;">
                        <i class="fas fa-search"></i> Search Again
                    </button>
                </div>
            </div>
            
            <div id="FailedContainer" class="hidden">
                <div class="empty-state">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3><span id="Failedh1"></span></h3>
                    <p><span id="Failedp"></span></p>
                </div>
            </div>
            
            <!-- Loading state -->
            <div id="loadingIndicator" class="loading hidden">
                <div class="spinner"><img class="mona" src="faild.gif" alt="">
                    <p>one moment please...</p>
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar" id="fetchProgressBar" style="width: 0%"></div>
                </div>
                <div id="satiricalMessage" class="satirical-message">
                    <!-- Random satirical message will appear here -->
                </div>
            </div>
            
            <!-- Results list -->
            <div id="resultsList" class="hidden">
                <div class="result-count">Showing <span id="runCount">0</span> workflow runs</div>
                
                <div class="delete-all">
                    <button id="deleteAllBtn" class="btn btn-danger" disabled>
                        <i class="fas fa-trash-alt"></i> Delete All Runs
                    </button>
                </div>
                
                <div class="progress-container" id="progressContainer" class="hidden">
                    <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                </div>
                
                <div id="runsContainer"></div>
            </div>
        </div>
    </div>
    <footer class="footer">
        <p class="onep">Developed by <strong><a href="https://karrarnazim.netlify.app">Karrar Nazim</a></strong> </p>
        <div class="contact">
            <a href="https://github.com/SANDRO00O/workflow-run-deleter" target="_blank" rel="noopener">open source</a>
            <span> | </span>
            <a href="https://github.com/SANDRO00O" target="_blank" rel="noopener">Github</a>
            <span> | </span>
            <a href="https://karrarnazim.netlify.app" target="_blank" rel="noopener">Contact</a>
        </div>
        <p> GitHub Workflow Run Deleter <span class="version">v1.0</span></p>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elements
            const ownerInput = document.getElementById('owner');
            const repoInput = document.getElementById('repo');
            const tokenInput = document.getElementById('token');
            const statusSelect = document.getElementById('status');
            const fetchBtn = document.getElementById('fetchBtn');
            const runsContainer = document.getElementById('runsContainer');
            const resultsContainer = document.getElementById('resultsContainer');
            const FailedContainer = document.getElementById('FailedContainer');
            const Failedtext = document.getElementById('Failedp');
            const Failedtitle = document.getElementById('Failedh1');
            const resultsList = document.getElementById('resultsList');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const successContainer = document.getElementById('successContainer');
            const runCount = document.getElementById('runCount');
            const deleteAllBtn = document.getElementById('deleteAllBtn');
            const progressBar = document.getElementById('progressBar');
            const fetchProgressBar = document.getElementById('fetchProgressBar');
            const satiricalMessage = document.getElementById('satiricalMessage');
            const toastContainer = document.getElementById('toastContainer');
            const confirmModal = document.getElementById('confirmModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            const cancelBtn = document.getElementById('cancelBtn');
            const confirmBtn = document.getElementById('confirmBtn');
            const progressContainer = document.getElementById('progressContainer');
            const backToSearchBtn = document.getElementById('backToSearchBtn');
            
            // Satirical loading messages
            const satiricalMessages = [
                "While you wait, politicians are busy creating new workflows in the background...",
                "This is taking longer than fulfilling a campaign promise!",
                "Loading... like government efficiency, this might take a while.",
                "Fetching workflows at bureaucratic speed!",
                "If this were a political debate, we'd be waiting for the first honest answer...",
                "Loading processes with the urgency of a congressional holiday!",
                "This is slower than campaign finance reform!",
                "Fetching workflows at political change speed... very slow!",
                "Our servers are working as hard as politicians during election season!",
                "This delay is sponsored by the Slow Internet Communications Committee."
            ];
            
            // Helper function to toggle visibility
            function toggleElement(id, show) {
                const el = document.getElementById(id);
                if (show) {
                    el.classList.remove('hidden');
                } else {
                    el.classList.add('hidden');
                }
            }
            
            // Show toast notification
            function showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                toast.innerHTML = `
            <i class="fas ${type === 'error' ? 'fa-exclamation-circle' : 
                              type === 'success' ? 'fa-check-circle' : 
                              type === 'warning' ? 'fa-exclamation-triangle' : 
                              'fa-info-circle'}"></i>
            <span>${message}</span>
        `;
                
                toastContainer.appendChild(toast);
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    toast.classList.add('hide');
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }, 5000);
            }
            
            // Custom confirmation dialog
            function showConfirm(title, message) {
                return new Promise((resolve) => {
                    modalTitle.textContent = title;
                    modalBody.textContent = message;
                    confirmModal.classList.add('show');
                    
                    const handleConfirm = () => {
                        confirmModal.classList.remove('show');
                        resolve(true);
                        cleanUp();
                    };
                    
                    const handleCancel = () => {
                        confirmModal.classList.remove('show');
                        resolve(false);
                        cleanUp();
                    };
                    
                    const cleanUp = () => {
                        confirmBtn.removeEventListener('click', handleConfirm);
                        cancelBtn.removeEventListener('click', handleCancel);
                    };
                    
                    confirmBtn.addEventListener('click', handleConfirm);
                    cancelBtn.addEventListener('click', handleCancel);
                });
            }
            
            // Show satirical message after delay
            let satiricalTimeout;
            
            function showSatiricalMessage() {
                clearTimeout(satiricalTimeout);
                satiricalTimeout = setTimeout(() => {
                    const randomIndex = Math.floor(Math.random() * satiricalMessages.length);
                    satiricalMessage.textContent = satiricalMessages[randomIndex];
                    satiricalMessage.style.display = 'block';
                }, 10000); // Show after 10 seconds of loading
            }
            
            // Hide satirical message
            function hideSatiricalMessage() {
                clearTimeout(satiricalTimeout);
                satiricalMessage.style.display = 'none';
            }
            
            // Fetch workflow runs
            fetchBtn.addEventListener('click', async function() {
                const owner = ownerInput.value.trim();
                const repo = repoInput.value.trim();
                const token = tokenInput.value.trim();
                
                if (!owner || !repo || !token) {
                    showToast('Please fill all fields', 'error');
                    return;
                }
                
                // Show loading, hide others
                toggleElement('successContainer', false);
                toggleElement('resultsContainer', false);
                toggleElement('FailedContainer', false);
                toggleElement('loadingIndicator', true);
                toggleElement('resultsList', false);
                fetchProgressBar.style.width = '0%';
                
                // Start showing satirical message if loading takes too long
                showSatiricalMessage();
                
                try {
                    // Simulate progress for demo
                    let progress = 0;
                    const progressInterval = setInterval(() => {
                        progress += 5;
                        fetchProgressBar.style.width = `${progress}%`;
                        if (progress >= 100) clearInterval(progressInterval);
                    }, 200);
                    
                    // Call GitHub API
                    const runs = await fetchWorkflowRuns(owner, repo, token);
                    
                    // Clear progress interval and set to 100%
                    clearInterval(progressInterval);
                    fetchProgressBar.style.width = '100%';
                    
                    hideSatiricalMessage();
                    
                    if (runs.length === 0) {
                        toggleElement('resultsContainer', true);
                        showToast('No workflow runs found for this repository', 'info');
                        Failedtitle.textContent = 'nothing';
                        Failedtext.textContent = 'No workflow runs found for this repository';
                        toggleElement('FailedContainer', true);
                    } else {
                        displayRuns(runs);
                        toggleElement('resultsList', true);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showToast(`Failed to fetch workflow runs: ${error.message}`, 'error');
                    Failedtitle.textContent = 'Failed to fetch workflow runs';
                    Failedtext.textContent = error.message;
                    toggleElement('FailedContainer', true);
                    hideSatiricalMessage();
                } finally {
                    toggleElement('loadingIndicator', false);
                }
            });
            
            // Delete all runs
            deleteAllBtn.addEventListener('click', async function() {
                const owner = ownerInput.value.trim();
                const repo = repoInput.value.trim();
                const token = tokenInput.value.trim();
                
                if (!owner || !repo || !token) {
                    showToast('Please fill all fields', 'error');
                    return;
                }
                
                const runElements = runsContainer.querySelectorAll('.workflow-run');
                const runIds = Array.from(runElements).map(el => parseInt(el.dataset.id));
                
                if (runIds.length === 0) {
                    showToast('No runs to delete', 'error');
                    return;
                }
                
                // Use custom confirmation dialog
                const confirmed = await showConfirm(
                    'Confirm Deletion',
                    `Are you sure you want to delete ${runIds.length} workflow runs? This action cannot be undone.`
                );
                
                if (!confirmed) return;
                
                // Setup UI for deletion
                const originalButtonText = deleteAllBtn.innerHTML;
                deleteAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deleting...';
                deleteAllBtn.disabled = true;
                toggleElement('progressContainer', true);
                progressBar.style.width = '0%';
                
                let deletedCount = 0;
                
                try {
                    for (const runId of runIds) {
                        try {
                            await deleteWorkflowRun(owner, repo, token, runId);
                            // Remove element from DOM
                            const runElement = document.querySelector(`.workflow-run[data-id="${runId}"]`);
                            if (runElement) {
                                runElement.remove();
                            }
                            deletedCount++;
                            
                            // Update progress bar
                            const progress = Math.round((deletedCount / runIds.length) * 100);
                            progressBar.style.width = `${progress}%`;
                        } catch (error) {
                            console.error(`Error deleting run ${runId}:`, error);
                            showToast(`Failed to delete run #${runId}: ${error.message}`, 'error');
                        }
                    }
                    
                    runCount.textContent = '0';
                    toggleElement('resultsList', false);
                    toggleElement('successContainer', true);
                    
                    showToast(`Successfully deleted ${deletedCount} workflow runs`, 'success');
                } finally {
                    deleteAllBtn.innerHTML = originalButtonText;
                    deleteAllBtn.disabled = false;
                    toggleElement('progressContainer', false);
                }
            });
            
            // Back to search button
            backToSearchBtn.addEventListener('click', function() {
                toggleElement('successContainer', false);
                toggleElement('resultsContainer', true);
            });
            
            // Fetch workflow runs from GitHub API
            async function fetchWorkflowRuns(owner, repo, token) {
                const perPage = 100;
                let page = 1;
                let allRuns = [];
                
                try {
                    while (true) {
                        const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/actions/runs?per_page=${perPage}&page=${page}`, {
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'X-GitHub-Api-Version': '2022-11-28'
                            }
                        });
                        
                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                        }
                        
                        const data = await response.json();
                        const runs = data.workflow_runs || [];
                        
                        if (runs.length === 0) {
                            break; // No more results
                        }
                        
                        allRuns = allRuns.concat(runs);
                        page++;
                    }
                    
                    return allRuns;
                } catch (error) {
                    console.error('API error:', error);
                    throw new Error('Failed to fetch all workflow runs. Check your credentials and repository details.');
                }
            }
            
            // Delete single workflow run
            async function deleteWorkflowRun(owner, repo, token, runId) {
                try {
                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/actions/runs/${runId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'X-GitHub-Api-Version': '2022-11-28'
                        }
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Delete error:', error);
                    throw new Error('Failed to delete workflow run');
                }
            }
            
            // Display workflow runs
            function displayRuns(runs) {
                if (!runs || runs.length === 0) {
                    toggleElement('resultsContainer', true);
                    toggleElement('resultsList', false);
                    return;
                }
                
                runsContainer.innerHTML = '';
                runCount.textContent = runs.length;
                
                // Filter runs by status if needed
                const statusFilter = statusSelect.value;
                const filteredRuns = statusFilter === 'all' ?
                    runs :
                    runs.filter(run => run.conclusion === statusFilter);
                
                if (filteredRuns.length === 0) {
                    runsContainer.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-filter"></i>
                    <h3>No runs match your filter</h3>
                    <p>Try changing the status filter</p>
                </div>
            `;
                    deleteAllBtn.disabled = true;
                    return;
                }
                
                filteredRuns.forEach(run => {
                    const runElement = document.createElement('div');
                    runElement.className = 'workflow-run';
                    runElement.dataset.id = run.id;
                    
                    // Format date
                    const runDate = new Date(run.created_at);
                    const formattedDate = runDate.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    // Status badge
                    let statusClass = '';
                    let statusText = '';
                    
                    switch (run.conclusion) {
                        case 'success':
                            statusClass = 'status-success';
                            statusText = 'Success';
                            break;
                        case 'failure':
                            statusClass = 'status-failure';
                            statusText = 'Failed';
                            break;
                        case 'cancelled':
                            statusClass = 'status-cancelled';
                            statusText = 'Cancelled';
                            break;
                        default:
                            statusClass = 'status-pending';
                            statusText = run.status.charAt(0).toUpperCase() + run.status.slice(1);
                    }
                    
                    runElement.innerHTML = `
                <div class="run-info">
                    <div class="run-id">#${run.id} - ${run.name}</div>
                    <div>Branch: ${run.head_branch} | Date: ${formattedDate}</div>
                    <div class="run-status ${statusClass}">${statusText}</div>
                </div>
                <div class="run-actions">
                    <button class="btn btn-danger delete-btn" data-id="${run.id}">
                        <i class="fas fa-trash-alt"></i> Delete
                    </button>
                </div>
            `;
                    
                    runsContainer.appendChild(runElement);
                    
                    // Add event listener to delete button
                    const deleteBtn = runElement.querySelector('.delete-btn');
                    deleteBtn.addEventListener('click', async function() {
                        const runId = this.getAttribute('data-id');
                        const owner = ownerInput.value.trim();
                        const repo = repoInput.value.trim();
                        const token = tokenInput.value.trim();
                        
                        if (!owner || !repo || !token) {
                            showToast('Please fill all fields', 'error');
                            return;
                        }
                        
                        // Use custom confirmation dialog
                        const confirmed = await showConfirm(
                            'Confirm Deletion',
                            `Are you sure you want to delete workflow run #${runId}?`
                        );
                        
                        if (!confirmed) return;
                        
                        try {
                            await deleteWorkflowRun(owner, repo, token, runId);
                            runElement.remove();
                            runCount.textContent = parseInt(runCount.textContent) - 1;
                            showToast(`Workflow run #${runId} deleted.`, 'success');
                            
                            if (parseInt(runCount.textContent) === 0) {
                                toggleElement('resultsList', false);
                                toggleElement('resultsContainer', true);
                            }
                        } catch (error) {
                            showToast(`Failed to delete run #${runId}: ${error.message}`, 'error');
                        }
                    });
                });
                
                deleteAllBtn.disabled = false;
            }
        });
    </script>
</body>

</html>